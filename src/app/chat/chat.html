<div  class="chat-container" [class.open]="isOpen">
  <div *ngIf="!isOpen" class="chat-icon" (click)="toggleChat()">
    💬
  </div>

  <div class="chat-box" *ngIf="isOpen">
    <div class="chat-header">
      <span>Ask TAPPY, your AI Assistant</span>
      <button class="close-btn" (click)="toggleChat()">✕</button>
    </div>

    <div class="input-wrapper">
      <textarea [(ngModel)]="question"
                class="question-input"
                placeholder="Type your question..."></textarea>

      <button *ngIf="!isListening" class="mic-button"
              (click)="startVoiceRecognition()"
              [disabled]="isListening"
              title="Speak your question">
        <svg xmlns="http://www.w3.org/2000/svg"
             width="18"
             height="18"
             fill="currentColor"
             class="bi bi-mic"
             viewBox="0 0 16 16">
          <path d="M3.5 6.5A.5.5 0 0 1 4 7v1a4 4 0 0 0 8 0V7a.5.5 0 0 1 1 0v1a5 5 0 0 1-4.5 4.975V15h3a.5.5 0 0 1 0 1h-7a.5.5 0 0 1 0-1h3v-2.025A5 5 0 0 1 3 8V7a.5.5 0 0 1 .5-.5"/>
          <path d="M10 8a2 2 0 1 1-4 0V3a2 2 0 1 1 4 0zM8 0a3 3 0 0 0-3 3v5a3 3 0 0 0 6 0V3a3 3 0 0 0-3-3"/>
        </svg>
      </button>
      <div *ngIf="isListening" class="listening-hint">🎙️ Listening...</div>
    </div>

    

    <button class="ask-button" (click)="askQuestion()" [disabled]="loading">
      {{ loading ? 'Sending...' : 'Ask' }}
    </button>

    <div *ngIf="reply" class="chat-reply">
      <strong>Assistant:</strong> {{ reply }}
    </div>

    <div *ngIf="error" class="chat-error">
      {{ error }}
    </div>
  </div>
</div>
